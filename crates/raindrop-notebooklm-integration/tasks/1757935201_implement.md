# Raindrop-NotebookLM Integration 実装計画

**作成日時:** 2025-09-15
**プロジェクト:** raindrop-notebooklm-integration

## Phase 1: プロジェクトセットアップ

### [x] 1.1 基本プロジェクト構造の確認
- [x] Cargo.toml の依存関係確認
- [x] src/main.rs の基本構造確認
- [x] 必要なディレクトリ構造の作成

### [x] 1.2 基本依存関係の追加
- [x] tokio (非同期ランタイム)
- [x] reqwest (HTTP クライアント)
- [x] serde (シリアライゼーション)
- [x] clap (CLI パーサー)
- [x] anyhow (エラーハンドリング)
- [x] thiserror (カスタムエラー)
- [x] dotenv (.env ファイル対応)
- [x] serde_json (JSON シリアライゼーション)

## Phase 2: エラーハンドリングの実装

### [x] 2.1 error.rs の作成
- [x] AppError enum の定義
- [x] RaindropError
- [x] ContentError
- [x] NotebookLMError
- [x] ConfigError
- [x] StorageError
- [x] thiserror::Error の実装

## Phase 3: 設定管理の実装

### [x] 3.1 config.rs の作成
- [x] Config struct の定義
- [x] 環境変数からの設定読み込み
- [x] .env ファイル対応
- [x] 設定の検証機能

### [x] 3.2 設定項目の実装
- [x] raindrop_api_key
- [x] notebooklm_api_key
- [x] max_urls (オプション)
- [x] output_dir
- [x] content_filters

## Phase 4: CLIインターフェースの実装

### [x] 4.1 CLI引数の定義
- [x] clap を使った引数パーサーの実装
- [x] --tag 引数の実装
- [x] --max-urls 引数の実装
- [x] --output-dir 引数の実装
- [x] ヘルプメッセージの作成

### [x] 4.2 main.rs の基本構造
- [x] CLI引数のパース
- [x] 設定の初期化
- [x] エラーハンドリングのセットアップ

## Phase 5: データ構造の定義

### [ ] 5.1 Raindrop データ構造
- [ ] Bookmark struct の定義
- [ ] API レスポンス構造体の定義
- [ ] serde derive の実装

### [ ] 5.2 Content データ構造
- [ ] PageContent struct の定義
- [ ] URL、タイトル、コンテンツフィールド
- [ ] 取得日時の記録

### [ ] 5.3 NotebookLM データ構造
- [ ] Note struct の定義
- [ ] API リクエスト構造体の定義

## Phase 6: Raindrop.io API クライアントの実装

### [ ] 6.1 raindrop.rs の基本構造
- [ ] RaindropClient struct の定義
- [ ] HTTP クライアントのセットアップ
- [ ] 認証ヘッダーの実装

### [ ] 6.2 API メソッドの実装
- [ ] authenticate() メソッド
- [ ] fetch_bookmarks_by_tag() メソッド
- [ ] エラーハンドリング
- [ ] レート制限対応

## Phase 7: コンテンツ取得機能の実装

### [ ] 7.1 content.rs の基本構造
- [ ] ContentFetcher struct の定義
- [ ] HTTP クライアントの設定
- [ ] User-Agent の設定

### [ ] 7.2 コンテンツ取得メソッド
- [ ] fetch_content() メソッドの実装
- [ ] HTMLパースの実装 (scraper クレート)
- [ ] テキスト抽出の実装
- [ ] タイムアウト処理

### [ ] 7.3 エラー処理とリトライ機能
- [ ] ネットワークエラーの処理
- [ ] 指数バックオフによるリトライ
- [ ] 失敗したURLのスキップ処理

## Phase 8: 進捗表示の実装

### [ ] 8.1 progress.rs の作成
- [ ] ProgressTracker struct の定義
- [ ] プログレスバーの実装
- [ ] 現在の処理状況の表示

### [ ] 8.2 進捗情報の統合
- [ ] ブックマーク取得進捗
- [ ] コンテンツ取得進捗
- [ ] 処理完了率の計算

## Phase 9: ストレージ機能の実装

### [ ] 9.1 storage.rs の基本構造
- [ ] FileManager struct の定義
- [ ] 出力ディレクトリの作成
- [ ] ファイル名の重複回避

### [ ] 9.2 データ保存機能
- [ ] JSON保存機能 (save_json)
- [ ] ログ出力機能 (write_log)
- [ ] Markdown サマリー出力

## Phase 10: NotebookLM API クライアントの実装（暫定）

### [ ] 10.1 notebooklm.rs の基本構造
- [ ] NotebookLMClient struct の定義
- [ ] 認証情報の設定
- [ ] API エンドポイントの定義

### [ ] 10.2 ノート作成機能
- [ ] create_note() メソッドの実装
- [ ] コンテンツのフォーマット処理
- [ ] API レスポンスの処理

**Note:** NotebookLM API の詳細が不明なため、この部分は仮実装となります。

## Phase 11: メイン処理フローの統合

### [ ] 11.1 main.rs の完成
- [ ] 設定読み込み処理
- [ ] Raindrop API からのブックマーク取得
- [ ] 各URLのコンテンツ取得
- [ ] データのローカル保存
- [ ] NotebookLM への送信（仮実装）

### [ ] 11.2 エラーハンドリングの統合
- [ ] 各段階でのエラー処理
- [ ] 部分的失敗時の継続処理
- [ ] 最終結果のサマリー出力

## Phase 12: テスト実装

### [ ] 12.1 ユニットテストの作成
- [ ] config.rs のテスト
- [ ] raindrop.rs のテスト（モック使用）
- [ ] content.rs のテスト
- [ ] storage.rs のテスト

### [ ] 12.2 統合テストの作成
- [ ] エンドツーエンドテストの設定
- [ ] テストデータの準備
- [ ] CI/CD 設定

## Phase 13: ドキュメントとサンプルの作成

### [ ] 13.1 使用方法ドキュメント
- [ ] README.md の作成
- [ ] 設定方法の説明
- [ ] 使用例の追加

### [ ] 13.2 サンプルファイル
- [ ] 設定ファイルのサンプル
- [ ] 実行例のスクリプト

## 実装の優先順位

1. **最優先**: Phase 1-4 (基本セットアップ)
2. **高優先**: Phase 5-7 (コアデータ取得機能)
3. **中優先**: Phase 8-9 (ユーザビリティ向上)
4. **低優先**: Phase 10 (NotebookLM統合 - API詳細待ち)
5. **完了前**: Phase 11-13 (統合とテスト)

## 動作確認用の最小実装

以下の順序で段階的に動作確認を行う：

1. **CLI引数パース** → コマンドライン引数が正しく処理される
2. **設定読み込み** → API キーが正しく取得される
3. **Raindrop API** → 指定タグのブックマークが取得される
4. **コンテンツ取得** → 各URLのコンテンツが取得される
5. **ローカル保存** → データがファイルに保存される
6. **全体統合** → 完全なフローが動作する

## 注意事項

- NotebookLM API の詳細が不明なため、Phase 10 は仮実装となる
- レート制限とエラーハンドリングを重視した設計
- レビュアーが段階的に確認できるよう、各 Phase で動作確認可能な状態を保つ
- テストデータを使用して、実際の API 呼び出し前に動作検証を行う